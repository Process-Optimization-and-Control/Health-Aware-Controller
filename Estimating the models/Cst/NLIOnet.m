function [y1,xf1] = NLIOnet(x1,xi1)
%NLIONET neural network simulation function.
%
% Auto-generated by MATLAB, 08-Mar-2021 14:17:42.
% 
% [y1,xf1] = NLIOnet(x1,xi1) takes these arguments:
%   x1 = 10xTS matrix, input #1
%   xi1 = 10x3 matrix, initial 3 delay states for input #1.
% and returns:
%   y1 = 1xTS matrix, output #1
%   xf1 = 10x3 matrix, final 3 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-1.03797286522284;-4.46248802722717;-5.17852887458485;-4.48073715332605;-3.39270547151972;-4.89034267011056;-4.09638956423933;-22.1011864634595;-12.6725101583375;-1.68741224378933];
x1_step1.gain = [0.701732001985454;0.305647520874011;0.217139586607698;0.278754220747781;0.313094454989053;0.224952360464966;0.2398799497799;0.0883066374206199;0.130806471865733;0.582950679298246];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.3645257361670224405;-0.89698077331912906551;2.040147461547825003;0.40005003281465495446;-0.22174307790789360428;-1.0791779242023527008;0.39537098928606256854;0.28200356188875258523;0.41342311363588812867;0.19594156903120577007;0.96157373682099922529;-7.1630425425699790765;0.16329903983485036245;0.495815873144716035;1.191864245115585863];
IW1_1 = [-1.7478583583438851434 0.14934902045223882872 -0.014006960716279827708 -0.088657013932348344154 0.037318641289317638909 0.011605189993678129493 -0.027351412675621609299 -1.2081730026408017409 0.16016950410769242863 -0.13485579352609500248 1.5117192859744166267 0.29196663873076922346 -0.054663273371122304833 0.01878907736562767869 0.071764651354101482994 0.033432950765955288253 0.052901413014815566738 1.3254739549725149672 0.43327259946018997772 0.10457223281242535029 -0.42403789610739817117 -0.26744563889946010304 -0.055221757848309689642 0.024262532745285284724 -0.031744107038678616439 0.039980779764306119406 0.029198674497651951748 1.169008972917154443 -0.65534335707905033708 -0.27008529793647689798;-0.52114047233703320039 -0.43738396112217958756 0.063085710688862511875 0.13778787555885449456 0.15038492717665830067 0.063808743384859811787 0.040165782630390965691 0.36389519560643174279 -0.19886138544712150811 -0.034752974948019037249 -0.22824990829170313522 0.021236577819446832843 0.099161726364704771974 -0.020122567300195584594 -0.06973293197830450485 0.036843165110720055289 -0.14490981277898268287 0.069898183167931157711 -0.1902147747896257568 0.27265643195498490137 -1.0334132124845565315 -0.62796106457380995725 0.043588086053647515095 -0.18286485454895615166 0.23119219168476573545 0.037702691427142734359 -0.049629878035313094997 -1.1249641610687408644 0.75313115207063374701 0.086453764890621315198;-3.2442542678610601925 0.079727691462476754647 0.034923132282767603563 0.079192183644011135413 -0.0024044633638388812451 0.012395833908602688078 -0.024067718848958391531 1.3715740821498254576 -0.088094837826733593533 -0.13869137252181434894 -1.1951370209335632211 -0.007092496306778719832 -0.021766796854642982834 0.069312980632970352945 0.0051750470955838493228 0.024530518279777292767 -0.002678040172982668575 1.5406174336200668673 -0.36260414073817304192 -0.20137553766784319076 -0.82520721294547327851 0.041707334457249348181 -0.0043548871747016697914 -0.016836694596498530396 -0.0014167092473116164354 -0.0025527547770598543568 -0.0001786260008896702891 1.1833976911992285519 0.088373178320132333985 0.032687817433981684878;-1.1063735564718450988 -0.1285773736952182944 0.11656561141278240501 -0.18885042060330747837 0.023916005788197424592 0.04935747286417530022 0.043016187170829285613 -1.4480174147484623504 -0.7961912784105426022 0.17729011400299576895 0.94772906458505323801 1.433145115779268064 -0.034354860059409526862 -0.031201309696500673097 0.067951228788498699296 0.011272874176424849124 -0.010427123974413603572 1.518256221871877365 1.1465854818875516052 1.5343095929148962142 -0.19785678728887987066 -2.9639640481125084648 -0.013693837474515798552 -0.44817453094719084117 -0.010419985074387625931 -0.017961482301718380283 -0.0074394317261665329766 0.32087957532324323795 -0.26399331876149162435 -0.52021880646852503016;5.3730091440385425727 0.3053622498438718913 0.11140949857377097088 0.06783642906264343575 0.11654429829881798875 -0.011860463682109618697 -0.015768154567765313434 -1.9067578704338383755 0.19319245788266917185 0.060349325379897185428 -5.0073564955188594183 -0.099382118389036391837 -0.071817888340844238115 0.04055771039847351489 0.11426726827438470069 0.059502220071509417942 0.0010127981931770365168 1.1780041841231856381 1.075357055276260354 3.905441256226457547 -0.97378204482786934193 -0.45810161834134444092 -0.041853816045835781634 -0.18696704184361503942 0.054252413361570217543 -0.070027969716055696314 0.055829108418954540016 0.1476175970099042889 -1.0836455009467460542 -4.1683448156117686167;0.86359735180471330906 0.72738521386517385192 -0.015468122975050553267 -0.032045703577855751132 -0.061742053645066567735 -0.029507670953360445876 -0.0061063739248707728582 0.8697690941504366835 1.2820559495666197236 0.012770568493183928963 -1.1838516771870972732 -0.048614771916695838361 -0.017736182162123251965 -0.14870399573627832157 0.077926197837552266257 -0.020044236277111923683 -0.10446351712547509438 1.1437583985151014154 0.36853999440481793881 -0.48259320713739828346 -0.46589633669850710751 0.50843523392934208971 0.061031670162310619476 -0.11151420170753509331 0.080940928619098628793 -0.1595533504911532674 -0.087884212839965350494 -0.68665249146696283322 -1.5758333351589925986 0.0073059892826027464721;-1.5589264704801384376 0.55789130398082675821 0.02803164400798834402 -0.3444450024008681166 0.079502653532471698195 0.090748330091380460805 0.0029285092853706313522 -0.11657050973835031416 -0.27998545406735875218 -0.04789139574311718911 2.1011759438387218601 1.5172064723490650273 -0.10409688242090815724 -0.066966420132191215031 0.11445802739477270449 0.047749250564115372497 0.022125377926439062509 1.7830620397263330368 0.86754757010886485169 1.3385919329395989941 1.261337034779688393 -2.3131316867941786874 -0.030853844834994519769 -0.25398063133485160314 -0.0065312619305014389323 0.08030919466281233321 -0.018455602755399255072 0.5239025721064979324 -0.57810531647889740192 -1.0767479980851448751;0.63249598349894353699 0.034953637374981076646 0.050198360965164903758 0.037330442553887392687 0.016585147388440881627 0.0047415549675657369874 -0.019586038698381155049 0.95251530110946147634 -0.12444756505002790847 -0.032461098165911445035 -1.5373476567928654468 -0.038599080818099575085 -0.017710612663045514903 0.052181493573899034866 0.018271994988853221265 0.017114381431251900201 -0.007993250552407557552 0.50341894309010370989 -0.13298870042881810738 -0.12799369590646986206 -0.50483816374748058387 -0.054305337528942843051 -0.0098147977785365582426 -0.013444308234182212117 0.021023375658469106025 -0.0030350148853226840279 0.0024189610219923400949 0.51035668815619927852 0.13762649116533684501 0.028246256136084973987;-0.15914278320580005355 -0.02244801356911427237 0.12736329462182946481 -0.18492099718979265743 0.034398763809065979746 0.05029216110950343599 0.031750941002317421835 -1.4099985073103784572 -0.76754026684434850658 0.17347011418764982094 0.10879072014690546744 1.3366319372112309694 -0.028057860980799063932 -0.054346410111771124851 0.078721914879337037685 0.0068175617807813525262 -0.013222107055841597276 1.2845321638352100724 1.1737669365787004594 1.5026863786239792464 -0.18978917824384833324 -2.8151717721727020916 0.0023741072046828139673 -0.43945414152350059656 -0.012299997830754279618 -0.017152901416334239565 -0.0071735344278966136147 0.3131493149060722847 -0.28953707952090929068 -0.61050778782900716468;-3.1788964625413980158 0.24172795186634038478 0.087712074073302462307 0.07114914691380685996 0.12162553893457843379 -0.015103186840221039661 -0.01710115282154126698 -2.5455230460318190033 0.37801848905525248234 0.02938551711144612999 3.4920075690985177275 0.017951667571301923448 -0.091044993233863058535 0.059575192272115634617 0.14177824822606838184 0.074318006657396518122 0.017126238664604935547 1.3121257427733505896 1.3064905389431928917 4.6938866761774038494 -1.0117188141622497355 -0.45814061938382177885 -0.076296648102572764416 -0.17316752155948186842 0.048868586937258290392 -0.068511152083223142428 0.057606049547326440563 -0.042240505909239410565 -1.418996180650935246 -5.0098307206087531185;-3.9691213133408811409 -0.2161369155288071775 0.019963670743005038771 0.087271349529446956561 0.036450314548899458156 0.0087888532798342262203 0.01495068026411924822 1.4320152947001634214 -0.19305795151743318505 0.10960865055336686813 3.8981702288394939337 -0.10204462415789376795 0.017277475189598927308 0.010932069383137251947 -0.014356597308261505319 -0.0046958551961673406991 -0.048643333415753303717 -1.1759145333465959027 -0.28373662787786707584 -0.11151993789525138645 0.078195110915490168013 0.012895495606145560702 0.0087156393091901897957 -0.028670706222491227494 0.096295498365636916782 -0.01499753729934758667 -0.02274369063656439538 -1.1602877393649853044 0.68347784521931054247 0.18312799457975476036;2.5640721444581511257 -0.070847048897213008023 -0.015827818904612770551 -0.068474877168924128124 0.0089614450329902443915 -0.013969670995022477611 0.020060272487290562587 -1.1068145117599286209 0.04497842515711077821 0.1613275487818156273 7.2000513561303147725 -0.024185293030975302253 0.019356873569543631142 -0.05210873410604985323 -0.0013749062302345000427 -0.021214494720121580829 -0.0036890311774029514377 -1.6118630684152073229 0.36263257830170719798 0.1674554322971898157 0.84416967126581277103 -0.054954963418434484013 0.0011190626655088928808 0.017554571378611664306 0.015439126683485536462 0.0019874642228374927999 0.00039842540631393908585 -1.3032454738103596004 -0.02264863220582580966 -0.026360919899458781779;-0.76781777733889167159 0.013548560003128214124 0.025654733489046423894 0.069698347095679194507 0.022362886028858802723 -0.0021116587737880147639 0.0045384578345008998873 1.5484438632409158743 0.1765501621482510608 -0.016966827943124741795 0.37239173193773938975 -0.12019037158051054659 -0.0045728173190939325546 -0.0049304767340096729636 0.018783500990306851997 0.00090588039620493373671 -0.065408170127408848948 -0.38069987517106418373 -0.13499050747587626464 -0.24764013628901221376 -0.31174363121490616946 0.12963296213170408255 0.0092363014623510659995 -0.052923466461743680356 0.10957048165433848352 -0.056584905321292483515 -0.035969245703830962646 -0.88948003496960492686 0.12394305899998597775 0.1464858888614288257;1.6026163404589135464 -0.77165855063084454191 0.11234898308107559017 0.25308140184023164565 0.16296081876919524256 0.066900925440543337896 0.078239684074153312277 -0.56119959047994150136 -0.16248130885907116627 -0.057148818758976371868 -2.3735403952757780921 -0.21529393692830947615 0.20463644193314906028 -0.064161636135011981819 -0.16528548043149215996 0.031318845499034464464 -0.23773241019026650211 0.093064122221874226448 -0.24412150680174093953 0.43956849021609634143 -1.1945764954830835336 -0.67746677842315294882 0.1029638672061936322 -0.30392472313173396481 0.29735707557851365213 0.018519434502644274709 -0.084306399704458523381 -1.7464895115929688352 0.92468047187581059454 0.25116174556007780927;-1.7403285249730715556 0.55524661298312494306 0.064719094396022816551 -0.39474720813478297865 0.087269051175790895991 0.095973859385363360919 0.027451835821998667869 -0.43714377000363174863 -0.36246901710104689753 0.054830613867344432655 2.3154425266198233047 1.7542193007905495516 -0.11368821157886957463 -0.092292303680735363058 0.10419991598853478587 0.049654373754248519457 0.010460459980391682844 1.9295377630754009246 1.0459189309193768214 1.6589705680353572514 1.3403159528380177434 -2.7845271617902387362 -0.037126947111437026694 -0.3461410537621315564 -0.0023808029345170817793 0.074228846399693626523 -0.025618960742982060941 0.40346776186783167573 -0.61674555775088724108 -1.2322674578413441715];

% Layer 2
b2 = -2.341847214503259611;
LW2_1 = [1.7069390274117803852 -2.5690814337285110547 -4.9097943203303842097 1.3237754087890862831 1.3324417085884450174 0.85097642313532395608 1.5327164136547668516 3.6804036232319075062 -1.4610831080193820153 -1.2233210398697635934 2.6053035407733364792 -4.8994708586305719678 -3.1231208834725774359 1.5502215025028192041 -1.3197872377879169559];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 0.677942953516802;
y1_step1.xoffset = -1.24456183373413;

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(10,1)];

% Allocate Outputs
y1 = zeros(1,TS);

% Time loop
for ts=1:TS

      % Rotating delay state position
      xdts = mod(ts+2,4)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3]-1,4)+1),30,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 3);
xits = finalxts(finalxts<=3);
xts = finalxts(finalxts>3)-3;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
